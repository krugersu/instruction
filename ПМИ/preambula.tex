%http://texblog.org/2011/09/09/10-ways-to-customize-tocloflot/

%Автоматически вписывать картинки в ширину страницы:
%\includegraphics[maxwidth=\linewidth]{foobar}

\if 0
Так можно сделать многострочный комментарий.
Это маленький хак. Его надо использовать.
\fi

\documentclass[twoside,11pt,landscape,a4paper,notitlepage]{report}

\makeatletter
\newcommand*{\toccontents}{\@starttoc{toc}}
\usepackage{pscyr}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\renewcommand{\rmdefault}{CMR}
\usepackage[russian]{babel}
%\usepackage[dvipsnames]{xcolor}
\usepackage{lscape}
\usepackage[landscape,margin=1in]{geometry}



%История изменений
%\usepackage{vhistory}
\usepackage[owncaptions]{vhistory}%[tocentry] включить в оглавление

\usepackage[most]{tcolorbox} % для управления цветом
\definecolor{block-gray}{gray}{0.90} % уровень прозрачности (1 - максимум)
\newtcolorbox{myquote}{colback=block-gray,grow to right by=-10mm,grow to left by=-10mm,
    boxrule=0pt,boxsep=0pt,breakable} % настройки области с изменённым фоном

%*************************
\usepackage{shorttoc}% Краткое оглавление
%*************************

%*************************
\usepackage{tocloft}% Управление оглавлением
%*************************




\pagestyle{plain} % нумерация страниц вкл.

\usepackage{booktabs}

%**********************************************************
\usepackage[os=win]{menukeys}
% меняестся стиль, тени у кнопок
%**********************************************************
%\changemenucolor{gray}{txt}{named}{red} %Изменение цвета
\renewmenumacro{\keys}[>]{shadowedroundedkeys}
\renewmenumacro{\menu}{roundedmenus} % default: menus
%\newmenumacro{\button}
%**********************************************************

\usepackage{titlesec}
\usepackage{csquotes} % ещё одна штука для цитат
\usepackage{sectsty}
\subsectionfont{\Large\underline}

\usepackage{graphicx}
\usepackage{sidecap}
%\usepackage{xcolor}
\usepackage{pdfpages}
\usepackage{comment}
\usepackage{textcomp}
\usepackage{wrapfig}
\usepackage{sectsty}
\usepackage{lipsum}
\usepackage{fancyhdr}
\usepackage{datetime}
\chapterfont{\centering}
\usepackage{caption}
\usepackage{subcaption}
\usepackage[T2A]{fontenc}
\usepackage{lscape}
\usepackage{makecell}
\usepackage{multicol}
\usepackage{floatrow}
\usepackage{float}
\usepackage{caption}
\usepackage{lastpage} % Allows referencing of the last page to allow footer to read: "Page [Current page] of [Total number of pages]."
\renewcommand{\familydefault}{\sfdefault} %Изменит стандартный шрифт документа на сансерифный.
\definecolor{MSBlue}{rgb}{.204,.353,.541}
\definecolor{MSLightBlue}{rgb}{.31,.506,.741}

\titleformat
{\chapter} % command
[display] % shape
{\bfseries\Large\itshape} % format
{Story No. \ \thechapter} % label
{0.5ex} % sep
{
    \rule{\textwidth}{1pt}
    \vspace{1ex}
    \centering
} % before-code
[
\vspace{-0.5ex}%
\rule{\textwidth}{0.3pt}
] % after-code

\titleformat{\section}[wrap]
{\normalfont\bfseries}
{\thesection.}{0.5em}{}
\titlespacing{\section}{12pc}{1.5ex plus .1ex minus .2ex}{1pc}


%*****************************************************
% Часто требуется, чтобы номер рисунка содержал в себе номер главы (вроде Рис. 1.1). Чтобы была сделана нумерация по главам, достаточно изменить счётчик рисунков в преамбуле документа вот так:
\renewcommand{\thefigure}{\thesection.\arabic{figure}}
%*****************************************************

%*****************************************************
%Если вас не устраивает вид подрисуночной подписи (например, вместо "Рис. 1:" необходимо "Рис. 1 --- "), используйте пакет caption. В частности, для установки тире в качестве разделителя, вставьте в преамбулу документа следующий код:
\RequirePackage{caption}
\DeclareCaptionLabelSeparator{defffis}{ --- }
\captionsetup{justification=centering,labelsep=defffis}
%*****************************************************
\usepackage[hypcap]{caption}
%*****************************************************
% Начинать секции с новой страницы
\usepackage{titlesec}
\newcommand{\sectionbreak}{\clearpage}
%*****************************************************

%*****************************************************
%Чтобы в генерированном PDF работали гиперссылки, то надо подключить модуль hyperref (и если хотите их разрисовать, то модуль по работе с цветами xcolor):

\usepackage{hyperref}
\usepackage{nameref}
% Цвета для гиперссылок
\definecolor{linkcolor}{HTML}{012b37} % цвет ссылок
\definecolor{urlcolor}{HTML}{012b37} % цвет гиперссылок
\hypersetup{pdfstartview=FitH,  linkcolor=linkcolor,urlcolor=urlcolor, colorlinks=true}
%*****************************************************

%*****************************************************
%Для удаления номеров страниц из \listoffigures
\makeatletter
\newcommand{\emptypage}[1]{%
    \cleardoublepage
    \begingroup
    \let\ps@plain\ps@empty
    \pagestyle{empty}
    #1
    \cleardoublepage}
\makeatletter
%*****************************************************


\setcounter{secnumdepth}{3}
\usepackage[shortlabels]{enumitem}
\setlist[enumerate]{leftmargin=*,align=left,label=\thesubsection.\arabic*.}
\usepackage{longtable}
\usepackage{multirow}


%\renewcommand{\rmdefault}{ftm}
\renewcommand{\rmdefault}{cmr}
\renewcommand{\thesection}{\arabic{section}}
\geometry{top=20mm}
\geometry{bottom=20mm}
\geometry{left=10mm}
\geometry{right=10mm}


%*****************************************************
%Here is how you can increase the space between the number and the caption in your \listoffigures. Add the following two lines before your \begin{document}:
\usepackage{tocloft}
\setlength{\cftfignumwidth}{3em}
%With the tocloft-package you can control the design of table of contents, figures and tables.
%*****************************************************


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%
%%% Моя любимая настройка параметров страницы. По умолчанию колонка узковатая
%%%
%\voffset=-10mm
%\topmargin=0mm
%\headheight=5mm
%\headsep=10mm

%\textheight=237mm
%\footskip=10mm

%\oddsidemargin=-2mm
%\evensidemargin=-15mm
% регулирует расстояние sidenotes от края страницы
%\hoffset=5mm
%\textwidth=250mm
%\marginparsep=10mm
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{caption}
\usepackage{svn}

\pagestyle{fancy}
\lhead{\footnotesize \parbox{11cm}}
\rhead{\footnotesize  \chaptername \ - \rightmark}
\fancyfoot{} % Clear all footer fields
\fancyfoot[RO,L] {v.\vhCurrentVersion \ \vhCurrentDate}  % Версия и дата
\fancyfoot[RO,R]{Страница \thepage \; из \pageref{LastPage}} % Page number on right in footer

\setlength{\headheight}{4pt}
\renewcommand{\footrulewidth}{0pt}

\graphicspath{{images/}}


%*****************************************************
%Номера страниц, включающие номер главы
\usepackage[auto]{chappg} %%% this is to set the page numbers as Chapter-Page.
%*****************************************************

\renewcommand{\theenumi}{\arabic{enumi}}
\renewcommand{\labelenumi}{\arabic{enumi}}
\renewcommand{\theenumii}{.\arabic{enumii}}
\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}.}
\renewcommand{\theenumiii}{.\arabic{enumiii}}
\renewcommand{\labelenumiii}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}.}


\usepackage{titlepic}


%**********************************************************

% Vertically aligning a marginnote and a section title
%**********************************************************
\usepackage{lipsum}

\usepackage{marginnote}
\reversemarginpar % To put the margin pars on the left
\renewcommand*{\marginfont}{\normalfont\normalsize}

\usepackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{backgrounds}

\newcommand*{\Date}[4]{%
    \begin{tikzpicture}[show background rectangle,inner frame sep=0pt,text width=1cm,align=center]
    \node [fill=orange] at (0,0)                                (dayofweek)  {#1};
    \node [fill=white ] at ($(dayofweek)  +(0,-\baselineskip)$) (dayofmonth) {#2};
    \node [fill=white ] at ($(dayofmonth) +(0,-\baselineskip)$) (month)      {#3};
    \node [fill=orange] at ($(month)      +(0,-\baselineskip)$) (dayofmonth) {#4};
    \end{tikzpicture}
}

%**********************************************************

\usepackage{marginnote}

\renewcommand{\cftchapfont}{\scshape}
\renewcommand{\cftsecfont}{\bfseries}

\usepackage{eso-pic}

%**********************************************************
\usepackage[os=win]{menukeys}
% меняестся стиль, тени у кнопок
%**********************************************************
%\changemenucolor{gray}{txt}{named}{red} %Изменение цвета
\renewmenumacro{\keys}[>]{shadowedroundedkeys}
\renewmenumacro{\menu}{roundedmenus} % default: menus
%\newmenumacro{\button}
%**********************************************************

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%How to remove headers and footers for pages between chapters?
\makeatletter
\renewcommand*{\cleardoublepage}{\clearpage\if@twoside \ifodd\c@page\else
    \hbox{}%
    \thispagestyle{empty}%
    \newpage%
    \if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\setlength{\abovecaptionskip}{-1pt}
\setlength{\belowcaptionskip}{-1pt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\Nameref{name}
%которая печатает в виде текста гиперссылки на мишень name как название раздела, в котором находится %мишень, так и номер страницы, на которой она находится. По умолчанию ссылка на номер
%страницы печатается на английском языке:
%В разделе ‘Закладки’ on page 7 . . . В разделе \Nameref{sec:bookmarks} \dots
%Поэтому для документов на русском языке команду \Nameref надо переопределить, скажем, так

\renewcommand{\Nameref}[1]{<<\nameref{#1}>> на стр.~\pageref{#1}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{booktabs}

\usepackage{lastpage} % Allows referencing of the last page to allow footer to read: "Page [Current page] of [Total number of pages]."

%*****************************************************
% Начинать subсекции с новой страницы

\newcommand{\subsectionbreak}{\clearpage}
%*****************************************************

% белые кнопки вызов \keystroke{Ctrl}
\newcommand*\keystroke[1]{%
    \tikz[baseline=(key.base)]
    \node[%
    draw,
    fill=white,
    drop shadow={shadow xshift=0.25ex,shadow yshift=-0.25ex,fill=black,opacity=0.75},
    rectangle,
    rounded corners=2pt,
    inner sep=1pt,
    line width=0.5pt,
    font=\scriptsize\sffamily
    ](key) {#1\strut}
    ;
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Для рамки "Внимание"
%\usepackage{fourier}

\usepackage[utf8]{inputenc}
\usepackage{newunicodechar}

\newcommand\Warning{%
    \makebox[1.4em][c]{%
        \makebox[0pt][c]{\raisebox{.1em}{\small!}}%
        \makebox[0pt][c]{\color{red}\Large$\bigtriangleup$}}}%

\newunicodechar{⚠}{\Warning}

%\renewcommand{\arraystretch}{1.8} %% расстояние между строками таблицы
% объявляем новую команду для переноса строки внутри ячейки таблицы
\newcommand{\specialcell}[2][c]{%
    \begin{tabular}[#1]{@{}c@{}}#2\end{tabular}}
%\renewcommand{\arraystretch}{1.8} %% increase table row spacing

%\usepackage{todonotes}
\usepackage[colorinlistoftodos,prependcaption,textsize=tiny]{todonotes}
\usepackage{blindtext}

%\usepackage{array}
%\setlenght{\arrayulewidth}{1mm}
%\setlength{\tabcolsep}{18pt}
%\renewcommand{\arraystretch}{1.5}

\usepackage{verbatim}